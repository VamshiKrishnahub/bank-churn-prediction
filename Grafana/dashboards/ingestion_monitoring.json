{
    "id": null,
    "uid": "ingestion-monitoring",
    "title": "Dashboard 1: Ingestion Monitoring",
    "tags": ["data-quality"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "30s",
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": ["10s", "30s", "1m", "5m"],
      "time_options": ["5m", "15m", "1h", "6h", "12h", "24h"]
    },
    "panels": [
      {
        "id": 1,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "type": "timeseries",
        "title": "Graph 1: Valid Data Percentage (Last 10 Min) - Temporal",
        "description": "Shows valid data percentage over time",
        "datasource": {"type": "postgres", "uid": "defence_db"},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT \n  created_at AS time,\n  ROUND((valid_rows::DECIMAL / NULLIF(total_rows, 0)) * 100, 2) AS value\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '10 minutes'\nORDER BY time ASC",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "lineWidth": 3,
              "fillOpacity": 20,
              "showPoints": "auto"
            },
            "color": {"mode": "thresholds"},
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "orange", "value": 50},
                {"color": "yellow", "value": 70},
                {"color": "green", "value": 80}
              ]
            }
          }
        },
        "options": {
          "tooltip": {"mode": "single"},
          "legend": {"showLegend": true, "displayMode": "list", "placement": "bottom", "calcs": ["mean", "last"]}
        },
        "alert": {
          "name": "Critical Data Quality Alert",
          "conditions": [
            {
              "evaluator": {"params": [50], "type": "lt"},
              "operator": {"type": "and"},
              "query": {"params": ["A", "5m", "now"]},
              "reducer": {"params": [], "type": "avg"},
              "type": "query"
            }
          ],
          "executionErrorState": "alerting",
          "for": "2m",
          "frequency": "1m",
          "message": "CRITICAL: Less than 50% of ingested data is valid! Immediate action required!",
          "noDataState": "no_data",
          "notifications": []
        }
      },
      {
        "id": 2,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "type": "timeseries",
        "title": "Graph 2: Overall Data Quality Score - Current vs Last 24 Hours",
        "description": "Shows if data quality is improving or degrading over time.",
        "datasource": {"type": "postgres", "uid": "defence_db"},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT \n  NOW() AS time,\n  ROUND(\n    (SUM(valid_rows)::DECIMAL / NULLIF(SUM(total_rows), 0)) * 100,\n    2\n  ) AS value,\n  'Current (Last 10 min)' AS metric\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '10 minutes'",
            "format": "table"
          },
          {
            "refId": "B",
            "rawSql": "SELECT \n  NOW() AS time,\n  ROUND(\n    (SUM(valid_rows)::DECIMAL / NULLIF(SUM(total_rows), 0)) * 100,\n    2\n  ) AS value,\n  'Yesterday Same Time' AS metric\nFROM ingestion_statistics\nWHERE created_at BETWEEN NOW() - INTERVAL '24 hours 10 minutes' AND NOW() - INTERVAL '24 hours'",
            "format": "table"
          },
          {
            "refId": "C",
            "rawSql": "SELECT \n  NOW() AS time,\n  ROUND(\n    (SUM(valid_rows)::DECIMAL / NULLIF(SUM(total_rows), 0)) * 100,\n    2\n  ) AS value,\n  'Last 24h Average' AS metric\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '24 hours'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 0,
              "showPoints": "always",
              "pointSize": 10
            },
            "color": {"mode": "palette-classic"},
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 70},
                {"color": "green", "value": 80}
              ]
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Current (Last 10 min)"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}},
                {"id": "custom.lineWidth", "value": 4}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "Yesterday Same Time"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}},
                {"id": "custom.lineStyle", "value": {"dash": [10, 5], "fill": "dash"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "Last 24h Average"},
              "properties": [
                {"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}},
                {"id": "custom.lineStyle", "value": {"dash": [2, 5], "fill": "dot"}}
              ]
            }
          ]
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {"showLegend": true, "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull"]}
        }
      },
      {
        "id": 3,
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 8},
        "type": "timeseries",
        "title": "Graph 3: Error Criticality Aggregation Over Time (Last Hour)",
        "description": "Aggregated count of high/medium/low severity errors over time.",
        "datasource": {"type": "postgres", "uid": "defence_db"},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT \n  DATE_TRUNC('minute', created_at) AS time,\n  SUM(CASE WHEN criticality = 'high' THEN invalid_rows ELSE 0 END) AS \"High Severity Errors\",\n  SUM(CASE WHEN criticality = 'medium' THEN invalid_rows ELSE 0 END) AS \"Medium Severity Errors\",\n  SUM(CASE WHEN criticality = 'low' THEN invalid_rows ELSE 0 END) AS \"Low Severity Errors\"\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '1 hour'\nGROUP BY time\nORDER BY time ASC",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "fillOpacity": 60,
              "showPoints": "never",
              "stacking": {"mode": "normal", "group": "A"}
            },
            "color": {"mode": "palette-classic"},
            "unit": "short"
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "High Severity Errors"},
              "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]
            },
            {
              "matcher": {"id": "byName", "options": "Medium Severity Errors"},
              "properties": [{"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}}]
            },
            {
              "matcher": {"id": "byName", "options": "Low Severity Errors"},
              "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]
            }
          ]
        },
        "options": {
          "tooltip": {"mode": "multi", "sort": "desc"},
          "legend": {
            "showLegend": true,
            "displayMode": "table",
            "placement": "bottom",
            "calcs": ["sum", "mean", "max"]
          }
        },
        "alert": {
          "name": "High Severity Errors Spike Alert",
          "conditions": [
            {
              "evaluator": {"params": [50], "type": "gt"},
              "operator": {"type": "and"},
              "query": {"params": ["A", "10m", "now"]},
              "reducer": {"params": [], "type": "sum"},
              "type": "query"
            }
          ],
          "executionErrorState": "alerting",
          "for": "3m",
          "frequency": "1m",
          "message": "WARNING: High number of severity errors detected (>50 in 10min). Multiple data quality issues occurring.",
          "noDataState": "ok",
          "notifications": []
        }
      },
      {
        "id": 4,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "type": "timeseries",
        "title": "Graph 4: Missing Value Errors Trend (Last Hour)",
        "description": "Tracks if missing value errors are increasing or decreasing over time.",
        "datasource": {"type": "postgres", "uid": "defence_db"},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT \n  DATE_TRUNC('minute', created_at) AS time,\n  SUM(invalid_rows) AS value\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '1 hour'\n  AND criticality IN ('medium', 'high')\nGROUP BY time\nORDER BY time ASC",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineWidth": 2,
              "fillOpacity": 30,
              "showPoints": "auto"
            },
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 10},
                {"color": "orange", "value": 30},
                {"color": "red", "value": 50}
              ]
            },
            "unit": "short"
          }
        },
        "options": {
          "tooltip": {"mode": "single"},
          "legend": {"showLegend": true, "displayMode": "list", "placement": "bottom", "calcs": ["mean", "last", "max"]}
        }
      },
      {
        "id": 5,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
        "type": "bargauge",
        "title": "Graph 5: Files with Missing Required Features by Time Period",
        "description": "Shows number of files with missing required columns across different time periods (10min, 30min, 1h).",
        "datasource": {"type": "postgres", "uid": "defence_db"},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT \n  'Last 10 Minutes' AS metric,\n  COUNT(*) AS value\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '10 minutes'\n  AND criticality = 'high'\n  AND invalid_rows = total_rows\nUNION ALL\nSELECT \n  'Last 30 Minutes' AS metric,\n  COUNT(*) AS value\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '30 minutes'\n  AND criticality = 'high'\n  AND invalid_rows = total_rows\nUNION ALL\nSELECT \n  'Last 1 Hour' AS metric,\n  COUNT(*) AS value\nFROM ingestion_statistics\nWHERE created_at > NOW() - INTERVAL '1 hour'\n  AND criticality = 'high'\n  AND invalid_rows = total_rows",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 1},
                {"color": "orange", "value": 3},
                {"color": "red", "value": 5}
              ]
            },
            "unit": "short"
          }
        },
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient",
          "showUnfilled": true
        },
        "alert": {
          "name": "Missing Required Columns Alert",
          "conditions": [
            {
              "evaluator": {"params": [3], "type": "gt"},
              "operator": {"type": "and"},
              "query": {"params": ["A", "10m", "now"]},
              "reducer": {"params": [], "type": "last"},
              "type": "query"
            }
          ],
          "executionErrorState": "alerting",
          "for": "5m",
          "frequency": "1m",
          "message": "CRITICAL: Multiple files (>3) with missing required columns! All rows in these files are completely invalid. Check data pipeline schema urgently.",
          "noDataState": "ok",
          "notifications": []
        }
      }
    ],
  "overwrite": true
}
